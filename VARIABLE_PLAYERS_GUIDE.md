# Catanatron è®Šæ•¸ç©å®¶æ”¯æ´æŒ‡å—

## æ¦‚è¿°

Catanatron ç¾åœ¨æ”¯æ´ **2-4 äººè®Šæ•¸ç©å®¶** éŠæˆ²ï¼Œä¸å†éœ€è¦å›ºå®š 4 äººæ‰èƒ½é–‹å§‹ã€‚ç³»çµ±æœƒæ™ºèƒ½ç­‰å¾…ç©å®¶åŠ å…¥ï¼Œä¸¦åœ¨é”åˆ°æ¢ä»¶æ™‚è‡ªå‹•é–‹å§‹éŠæˆ²ã€‚

## ğŸš€ å¿«é€Ÿé–‹å§‹

### ä½¿ç”¨è‡ªå‹•åŒ–è…³æœ¬ï¼ˆæ¨è–¦ï¼‰

```bash
# é è¨­æ¨¡å¼ï¼š2-4 äººéŠæˆ²ï¼Œç­‰å¾… 10 ç§’
./run_catanatron.sh

# 2 äººéŠæˆ²æ¨¡å¼
./run_catanatron.sh --min-players 2 --max-players 2 --wait-time 5

# 3 äººéŠæˆ²æ¨¡å¼
./run_catanatron.sh --min-players 3 --max-players 3 --wait-time 8

# æŸ¥çœ‹æ‰€æœ‰é¸é …
./run_catanatron.sh --help
```

### æ‰‹å‹•å•Ÿå‹•

```bash
# å•Ÿå‹•ä¼ºæœå™¨
python start_server.py --min-players 2 --max-players 4 --wait-time 10

# åœ¨å¦ä¸€å€‹çµ‚ç«¯å•Ÿå‹• LLM å®¢æˆ¶ç«¯
cd catanatron/catanatron/multiplayer
uv run python llm_agent_client.py --port 8001 --color RED --debug
uv run python llm_agent_client.py --port 8002 --color BLUE --debug
```

## ğŸ“‹ åŠŸèƒ½ç‰¹è‰²

### âœ… æ™ºèƒ½ç­‰å¾…æ©Ÿåˆ¶

- **æœ€å°‘ç©å®¶æ•¸é”æˆ**: é–‹å§‹å€’æ•¸è¨ˆæ™‚
- **æœ€å¤šç©å®¶æ•¸é”æˆ**: ç«‹å³é–‹å§‹éŠæˆ²
- **éˆæ´»é…ç½®**: æ”¯æ´ 2-4 äººä»»æ„çµ„åˆ

### âœ… è‡ªå‹•åŒ–ç®¡ç†

- **ç«¯å£è¡çªè™•ç†**: è‡ªå‹•æª¢æ¸¬ä¸¦æ¸…ç†ä½”ç”¨çš„ç«¯å£
- **é€²ç¨‹ç®¡ç†**: å„ªé›…çš„å•Ÿå‹•å’Œé—œé–‰
- **å®Œæ•´æ—¥èªŒ**: è©³ç´°çš„é‹è¡Œè¨˜éŒ„

### âœ… LLM æ•´åˆ

- **Google Gemini 2.0 Flash**: æœ€æ–°çš„ AI æ¨¡å‹
- **å¤šç©å®¶æ”¯æ´**: æ¯å€‹ç©å®¶ç¨ç«‹çš„ AI æ±ºç­–
- **èª¿è©¦æ¨¡å¼**: è©³ç´°çš„æ±ºç­–éç¨‹è¨˜éŒ„

## ğŸ® éŠæˆ²æ¨¡å¼

### 2 äººéŠæˆ²

```bash
./run_catanatron.sh --min-players 2 --max-players 2
```

- **ç©å®¶**: RED, BLUE
- **ç‰¹é»**: å¿«é€Ÿé–‹å§‹ï¼Œé©åˆæ¸¬è©¦å’Œå¿«é€ŸéŠæˆ²

### 3 äººéŠæˆ²

```bash
./run_catanatron.sh --min-players 3 --max-players 3
```

- **ç©å®¶**: RED, BLUE, WHITE
- **ç‰¹é»**: å¹³è¡¡çš„ç«¶çˆ­ç’°å¢ƒ

### 4 äººéŠæˆ²ï¼ˆå‚³çµ±æ¨¡å¼ï¼‰

```bash
./run_catanatron.sh --min-players 4 --max-players 4
```

- **ç©å®¶**: RED, BLUE, WHITE, ORANGE
- **ç‰¹é»**: å®Œæ•´çš„ Catan é«”é©—

### å½ˆæ€§æ¨¡å¼

```bash
./run_catanatron.sh --min-players 2 --max-players 4 --wait-time 15
```

- **è¡Œç‚º**: 2 äººå³å¯é–‹å§‹ï¼Œæœ€å¤šç­‰å¾… 4 äººï¼Œ15 ç§’å¾Œè‡ªå‹•é–‹å§‹

## âš™ï¸ é…ç½®é¸é …

### ä¼ºæœå™¨åƒæ•¸

| åƒæ•¸            | é è¨­å€¼  | èªªæ˜             |
| --------------- | ------- | ---------------- |
| `--min-players` | 2       | æœ€å°‘ç©å®¶æ•¸ (2-4) |
| `--max-players` | 4       | æœ€å¤šç©å®¶æ•¸ (2-4) |
| `--wait-time`   | 10      | ç­‰å¾…æ™‚é–“ï¼ˆç§’ï¼‰   |
| `--host`        | 0.0.0.0 | ä¼ºæœå™¨ä¸»æ©Ÿåœ°å€   |
| `--no-cleanup`  | False   | è·³éç«¯å£æ¸…ç†     |

### ç«¯å£é…ç½®

| ç©å®¶é¡è‰² | ç«¯å£ | WebSocket åœ°å€      |
| -------- | ---- | ------------------- |
| RED      | 8001 | ws://localhost:8001 |
| BLUE     | 8002 | ws://localhost:8002 |
| WHITE    | 8003 | ws://localhost:8003 |
| ORANGE   | 8004 | ws://localhost:8004 |

## ğŸ”§ æŠ€è¡“å¯¦ç¾

### æ ¸å¿ƒä¿®æ”¹

1. **GameEngineServer é¡å¢å¼·**

   - æ–°å¢ `min_players` å’Œ `max_players` åƒæ•¸
   - å¯¦ç¾æ™ºèƒ½ç­‰å¾…é‚è¼¯
   - æ”¯æ´å‹•æ…‹ç©å®¶æ•¸é‡

2. **start_server.py è…³æœ¬**

   - å‘½ä»¤è¡Œåƒæ•¸è§£æ
   - è‡ªå‹•ç«¯å£æ¸…ç†
   - åƒæ•¸é©—è­‰

3. **run_catanatron.sh è‡ªå‹•åŒ–è…³æœ¬**
   - å®Œæ•´çš„ç”Ÿå‘½é€±æœŸç®¡ç†
   - å¤šé€²ç¨‹å”èª¿
   - éŒ¯èª¤è™•ç†å’Œæ¸…ç†

### éŠæˆ²é–‹å§‹é‚è¼¯

```python
async def check_all_players_connected(self):
    connected_count = len([conn for conn in self.player_connections.values() if conn.connected])

    if connected_count >= self.max_players:
        # é”åˆ°æœ€å¤§ç©å®¶æ•¸ï¼Œç«‹å³é–‹å§‹
        await self.start_game()
    elif connected_count >= self.min_players:
        # é”åˆ°æœ€å°‘ç©å®¶æ•¸ï¼Œé–‹å§‹å€’æ•¸
        if not self.start_game_timer:
            self.start_game_timer = asyncio.create_task(self._start_game_after_delay())
    else:
        # ç­‰å¾…æ›´å¤šç©å®¶
        await self.broadcast_waiting_message()
```

## ğŸ“Š ä½¿ç”¨ç¯„ä¾‹

### ç¯„ä¾‹ 1: å¿«é€Ÿ 2 äººéŠæˆ²

```bash
# å•Ÿå‹• 2 äººéŠæˆ²ï¼Œ5 ç§’ç­‰å¾…
./run_catanatron.sh --min-players 2 --max-players 2 --wait-time 5

# é æœŸè¡Œç‚ºï¼š
# - ç¬¬ 1 å€‹ç©å®¶é€£æ¥ï¼šç­‰å¾…æ›´å¤šç©å®¶
# - ç¬¬ 2 å€‹ç©å®¶é€£æ¥ï¼šç«‹å³é–‹å§‹éŠæˆ²
```

### ç¯„ä¾‹ 2: å½ˆæ€§ 3-4 äººéŠæˆ²

```bash
# å•Ÿå‹•å½ˆæ€§éŠæˆ²ï¼Œ12 ç§’ç­‰å¾…
./run_catanatron.sh --min-players 3 --max-players 4 --wait-time 12

# é æœŸè¡Œç‚ºï¼š
# - 1-2 å€‹ç©å®¶ï¼šç­‰å¾…æ›´å¤šç©å®¶
# - 3 å€‹ç©å®¶ï¼šé–‹å§‹ 12 ç§’å€’æ•¸ï¼ŒæœŸé–“å¯åŠ å…¥ç¬¬ 4 å€‹ç©å®¶
# - 4 å€‹ç©å®¶ï¼šç«‹å³é–‹å§‹éŠæˆ²
# - 12 ç§’å¾Œï¼šä»¥ 3 å€‹ç©å®¶é–‹å§‹éŠæˆ²
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

**Q: ç«¯å£è¢«ä½”ç”¨æ€éº¼è¾¦ï¼Ÿ**

```bash
# è‡ªå‹•æ¸…ç†ï¼ˆæ¨è–¦ï¼‰
./run_catanatron.sh

# æ‰‹å‹•æ¸…ç†
python start_server.py --min-players 2 --max-players 2
```

**Q: éŠæˆ²æ²’æœ‰é–‹å§‹ï¼Ÿ**

- æª¢æŸ¥æ˜¯å¦æœ‰è¶³å¤ çš„å®¢æˆ¶ç«¯é€£æ¥
- æŸ¥çœ‹ `server.log` æ—¥èªŒæ–‡ä»¶
- ç¢ºèª LLM å®¢æˆ¶ç«¯æ­£å¸¸é‹è¡Œ

**Q: å¦‚ä½•åœæ­¢éŠæˆ²ï¼Ÿ**

```bash
# å¦‚æœä½¿ç”¨ run_catanatron.sh
Ctrl+C

# æ‰‹å‹•æ¸…ç†
pkill -f "start_server.py"
pkill -f "llm_agent_client.py"
```

### æ—¥èªŒæª¢æŸ¥

```bash
# æŸ¥çœ‹å³æ™‚æ—¥èªŒ
tail -f server.log

# æŸ¥çœ‹æœ€è¿‘çš„æ—¥èªŒ
tail -n 50 server.log

# æœå°‹ç‰¹å®šå…§å®¹
grep "game_started" server.log
```

## ğŸ”„ å‘å¾Œå…¼å®¹æ€§

- âœ… å®Œå…¨å‘å¾Œå…¼å®¹åŸæœ‰çš„ 4 äººéŠæˆ²æ¨¡å¼
- âœ… ç¾æœ‰çš„ LLM å®¢æˆ¶ç«¯ç„¡éœ€ä¿®æ”¹
- âœ… åŸæœ‰çš„éŠæˆ²é‚è¼¯ä¿æŒä¸è®Š
- âœ… API æ¥å£å®Œå…¨å…¼å®¹

## ğŸ“ˆ æ€§èƒ½å„ªåŒ–

- **ä¸¦è¡Œè™•ç†**: å¤šå€‹ç©å®¶åŒæ™‚é€£æ¥è™•ç†
- **æ™ºèƒ½ç­‰å¾…**: é¿å…ä¸å¿…è¦çš„å»¶é²
- **è³‡æºç®¡ç†**: è‡ªå‹•æ¸…ç†ç„¡ç”¨é€²ç¨‹å’Œç«¯å£
- **éŒ¯èª¤æ¢å¾©**: å„ªé›…çš„éŒ¯èª¤è™•ç†å’Œæ¢å¾©æ©Ÿåˆ¶

## ğŸ¯ æœªä¾†æ“´å±•

- [ ] Web UI æ”¯æ´è®Šæ•¸ç©å®¶
- [ ] è§€æˆ°æ¨¡å¼
- [ ] éŠæˆ²é‡æ’­åŠŸèƒ½
- [ ] æ›´å¤š AI æ¨¡å‹æ”¯æ´
- [ ] è‡ªå®šç¾©åœ°åœ–æ”¯æ´

---

## ğŸ“ æ”¯æ´

å¦‚æœ‰å•é¡Œæˆ–å»ºè­°ï¼Œè«‹æŸ¥çœ‹ï¼š

- æ—¥èªŒæ–‡ä»¶ï¼š`server.log`
- é€²ç¨‹ç‹€æ…‹ï¼š`ps aux | grep -E "(start_server|llm_agent)"`
- ç«¯å£ç‹€æ…‹ï¼š`lsof -i :8001-8004`

**äº«å—ä½ çš„ Catanatron è®Šæ•¸ç©å®¶éŠæˆ²ï¼** ğŸ²ğŸ†
